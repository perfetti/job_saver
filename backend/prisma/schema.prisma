// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Job {
  id                String   @id
  title             String
  company           String
  location          String?
  description       String?
  salaryLowerBound  Int?     @map("salary_lower_bound")
  salaryUpperBound  Int?     @map("salary_upper_bound")
  salaryCurrency    String?  @map("salary_currency")
  requirements      String?  // JSON string or array
  applicationUrl    String?  @map("application_url")
  sourceUrl         String?  @map("source_url")
  postedDate        String?  @map("posted_date")
  extractedAt       DateTime? @map("extracted_at")
  savedAt           DateTime @default(now()) @map("saved_at")
  excluded          Boolean  @default(false)
  tags              String?  // JSON array
  rejectedAt        DateTime? @map("rejected_at")
  acceptedAt        DateTime? @map("accepted_at")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")

  applications      Application[]
  communications    Communication[]

  @@map("jobs")
}

model Application {
  id          String   @id @default(uuid())
  jobId       String   @map("job_id")
  status      String   @default("started")
  startedAt   DateTime @default(now()) @map("started_at")
  submittedAt DateTime? @map("submitted_at")
  notes       String?
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  job         Job      @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@index([jobId])
  @@map("applications")
}

model Communication {
  id          String   @id @default(uuid())
  jobId       String?  @map("job_id")
  subject     String?
  from        String?
  to          String?
  body        String   // Full email body
  bodyText    String?  @map("body_text") // Plain text version
  receivedAt  DateTime? @map("received_at")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  job         Job?     @relation(fields: [jobId], references: [id], onDelete: SetNull)

  @@index([jobId])
  @@map("communications")
}

model UserProfile {
  id          String   @id @default("default")
  linkedinUrl String?  @map("linkedin_url")
  resumeData  String?  @map("resume_data") // JSON string
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("user_profile")
}

